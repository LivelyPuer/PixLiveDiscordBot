#!/bin/bash

##############################################################################
#  📦 SUMMARY: PixLive Discord Bot Deployment Ready
#
#  Проект PixLive Discord Bot полностью подготовлен к production развертыванию
#  на сервер с одной командой, включая автозапуск и обновление через GitHub.
#
##############################################################################

echo "
╔════════════════════════════════════════════════════════════════════════════╗
║                                                                            ║
║        ✅ PixLive Discord Bot - DEVELOPMENT COMPLETE                      ║
║                                                                            ║
║        Проект готов к production развертыванию на сервер                  ║
║        с полной автоматизацией, автозапуском и обновлением               ║
║                                                                            ║
╚════════════════════════════════════════════════════════════════════════════╝

## 🚀 БЫСТРЫЙ СТАРТ - ОДНА КОМАНДА

На сервере:
┌─────────────────────────────────────────────────────────────────────────┐
│ curl -fsSL https://raw.githubusercontent.com/LivelyPuer/PixLiveDiscord  │
│ Bot/main/install.sh | sudo bash                                         │
└─────────────────────────────────────────────────────────────────────────┘

Локально:
┌─────────────────────────────────────────────────────────────────────────┐
│ bash run.sh                                                              │
└─────────────────────────────────────────────────────────────────────────┘

## 📦 СОЗДАННЫЕ ФАЙЛЫ

### 🎯 Основные скрипты (4 файла)

1. ⭐ install.sh (7.8 KB)
   └─ Одна команда для полного развертывания на сервер
   └─ Определяет ОС, устанавливает зависимости, создает systemd сервис
   └─ Включает автозапуск и автоперезагрузку

2. 🔧 deploy.sh (14 KB)
   └─ Полное управление - интерактивное меню и команды
   └─ install, update, start, stop, restart, status, logs

3. 🔄 update.sh (2.1 KB)
   └─ Быстрое обновление кода с GitHub и перезагрузка

4. 🏃 run.sh (2.4 KB)
   └─ Локальный запуск для разработки (без root, без systemd)

### 📚 Документация (5 новых файлов)

1. DEPLOYMENT_READY.md (9.3 KB) - ⭐ ПРОЧИТАЙ ПЕРВЫМ
   └─ Полный обзор что было добавлено и как начать

2. QUICKSTART.md (5.3 KB)
   └─ Быстрый старт - одна команда и готово

3. DEPLOYMENT.md (11 KB)
   └─ Полная документация по развертыванию и управлению

4. SCRIPTS_FULL.md (11 KB)
   └─ Подробное описание каждого скрипта

5. pixlive.service (947 B)
   └─ Systemd файл для автозапуска (создается автоматически)

## ✨ КЛЮЧЕВЫЕ ВОЗМОЖНОСТИ

✅ Развертывание одной командой
✅ Автоматический запуск при старте сервера
✅ Автоматическая перезагрузка при падении бота
✅ Обновление кода через GitHub
✅ Интерактивное меню управления
✅ Логирование через systemd journal
✅ Поддержка Ubuntu/Debian/CentOS/Alpine
✅ Полная документация на русском и английском
✅ Секретные данные защищены (права 600 на .env)

## 🎮 УПРАВЛЕНИЕ БОТОМ

После развертывания все команды через systemd:

  sudo systemctl status pixlive      # Статус
  sudo systemctl start pixlive       # Запустить
  sudo systemctl stop pixlive        # Остановить
  sudo systemctl restart pixlive     # Перезагрузить
  sudo journalctl -u pixlive -f      # Логи

## 📋 ФАЙЛОВАЯ СТРУКТУРА

На сервере после развертывания:

/opt/PixLiveDiscordBot/
├── install.sh              # Скрипт установки
├── deploy.sh               # Полное управление
├── update.sh               # Обновление
├── run.sh                  # Локальный запуск
├── main.py                 # Точка входа
├── requirements.txt        # Python зависимости
├── .env                    # Конфигурация (ВАЖНО: хранить в безопасности)
├── README.md              # Основная документация
├── QUICKSTART.md          # Быстрый старт
├── DEPLOYMENT.md          # Полная документация
├── SCRIPTS_FULL.md        # Документация скриптов
├── venv/                  # Python виртуальное окружение
├── bot/                   # Код Discord бота
├── services/              # Сервисы (DeviantArt и т.д.)
├── data/                  # Данные и состояние (state.json)
└── tests/                 # Тесты

## 🔄 ОБНОВЛЕНИЕ

Одна команда для обновления кода и перезагрузки:

  sudo bash /opt/PixLiveDiscordBot/update.sh

Или вручную:

  cd /opt/PixLiveDiscordBot
  sudo git pull origin main
  sudo systemctl restart pixlive

## 🛠️ ТЕХНИЧЕСКИЕ ДЕТАЛИ

### Что делает install.sh

1. Определяет ОС (Ubuntu/Debian/CentOS/Alpine)
2. Устанавливает системные зависимости
   - Python 3, pip, venv
   - git, curl, wget
   - build-essential (для компиляции)
3. Создает пользователя 'pixlive'
4. Клонирует репозиторий в /opt/PixLiveDiscordBot
5. Создает Python виртуальное окружение
6. Устанавливает Python зависимости из requirements.txt
7. Создает systemd сервис файл
8. Включает автозапуск через systemctl enable
9. Запускает сервис

### Systemd сервис настроен на:

- Type=simple              (обычный процесс)
- Restart=always           (всегда перезагружается если упадет)
- RestartSec=10            (ждет 10 секунд перед перезагрузкой)
- StandardOutput=journal   (логи в systemd journal)
- NoNewPrivileges=true     (не может повысить привилегии)
- PrivateTmp=true          (отдельная временная папка)
- WantedBy=multi-user.target (запускается при старте системы)

## 📖 ДОКУМЕНТАЦИЯ

Все файлы лежат в корне проекта:

- README.md              - Основная документация проекта
- QUICKSTART.md          - Быстрый старт (НОВОЕ)
- DEPLOYMENT.md          - Полная документация (НОВОЕ)
- DEPLOYMENT_READY.md    - Что было добавлено (НОВОЕ)
- SCRIPTS_FULL.md        - Документация скриптов (НОВОЕ)
- SETUP.md               - Как получить токены
- SCRIPTS.md             - Старая документация скриптов

## 🆘 РЕШЕНИЕ ПРОБЛЕМ

### Если сервис не запускается

1. Проверь логи:
   sudo journalctl -u pixlive -n 50

2. Проверь конфигурацию .env:
   cat /opt/PixLiveDiscordBot/.env

3. Попытайся запустить вручную:
   /opt/PixLiveDiscordBot/venv/bin/python /opt/PixLiveDiscordBot/main.py

### Если нужно переустановить

sudo bash /opt/PixLiveDiscordBot/deploy.sh install

## ✅ CHECKLIST ПЕРЕД PRODUCTION

- [ ] Все токены добавлены в .env
- [ ] Протестировано локально (bash run.sh)
- [ ] Запущен install.sh на целевом сервере
- [ ] Отредактирован .env на сервере
- [ ] Проверен статус (systemctl status pixlive)
- [ ] Проверены логи (journalctl -u pixlive -f)
- [ ] Бот успешно постит сообщения

## 📊 СТАТИСТИКА

Файлы добавлены:
  - 4 скрипта (25+ KB кода)
  - 5 документов (40+ KB документации)
  - 1 systemd файл

Строк кода написано: ~1500+
Строк документации: ~2000+

## 🎉 ГОТОВО К ИСПОЛЬЗОВАНИЮ!

Проект полностью подготовлен к production развертыванию с полной автоматизацией.

Для развертывания используй:

  curl -fsSL https://raw.githubusercontent.com/LivelyPuer/PixLiveDiscordBot/main/install.sh | sudo bash

После установки:
  sudo nano /opt/PixLiveDiscordBot/.env  # Отредактировать конфиг
  sudo systemctl status pixlive          # Проверить статус
  sudo journalctl -u pixlive -f          # Смотреть логи

Бот будет работать автоматически, перезагружаться при падении и запускаться
при старте сервера.

Happy deploying! 🚀

═══════════════════════════════════════════════════════════════════════════════
"
